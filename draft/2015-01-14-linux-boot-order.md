---
layout: post
title: Linux启动顺序
category: linux
---

文章转太多了已不知道来源。稍作简化修改放上来做个备忘，可能还会有误，今后慢慢改。


### init以及之前
BIOS-->Kernel-->init-->各种守护进程

BIOS: flash Memory中的程序，主要任务是检测电脑的基础组件，如主板、内存和硬盘等。

Kernel: 通过MBR中的引导程序（LILO or GRUB）把内核映像装入内存运行。

init进程是Linux系统所有进程的父进程。



init程序的配置文件是/etc/inittab
第一个执行的脚本是/etc/init.d/rcS，它会执行/etc /rcS.d目录下的所有脚本。/etc/rcS.d目录下的脚本名都以大写字母“S”和一个顺序号开头，它们在系统初始化时都要被执行。

以”K“开头的脚本会先被执行，它调用了脚本的stop参数，用来关闭一些进程，接着再执行以”S“开头的脚本，它调用了脚本的start参数，用以启动进程。其实/etc/rcS.d目录下的所有脚本都是符号链接，真正执行的脚本存放在/etc/init.d 目录下。脚本会按从小到大的顺序执行，以S40开头的脚本执行之后，本地文件系统已加载，网络已启动，所有的驱动程序完成初始化。S60的脚本执行之后，系统时钟已设置，NFS文件系统已加载，文件系统已可用。

执行完系统级的初始化脚本后，init程序会继续执行默认运行级别指定的启动脚本。如指定的默认运行级别是5则会执行/etc/rc5.d目录下的脚本，如果是1则会执行/etc/rc1.d目录下的脚本。/etc/rc5.d目录下的脚本名的命名格式和rcS.d目录下的脚本一样，也是一些以“S”或“K”开头的符号链接。以“S”开头表示启动，以“K”开头的表示禁止。 Debian系统定义了从0到6共7个运行级别。每个级别代表意义如下：

Runlevel 0：关机操作，关闭所有程序，如果内核支持APM，还可以自动关闭主机电源。

Runlevel 1：单用户模式，提供一个root shell和只读的文件系统，该级别用于进行系统恢复。

Runlevel 2,3,4,5：多用户模式，由用户自由设定。

Runlevel 6：与级别0类似，但它不关闭电脑，而是重启电脑。

update-rc.d命令用以维护不同级别下的启动脚本，它会自动在rc?.d目录下创建到/etc/init.d目录中脚本的链接。在运行该命令前，请确保你要添加的启动脚本已位于/etc/init.d目录下。



### init之后

启动login登录界面 login

/etc/profile.d/file

/etc/profile 此文件为系统的每个用户设置环境信息,当用户第一次登录时,该文件被执行.并从/etc/profile.d目录的配置文件中搜集shell的设置.

~/.bash_profile 是交互式、login 方式进入bash 运行的。每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!默认情况下,他设置一些环境变量,执行用户的.bashrc文件. 

~/.profile

~/.bashrc 是交互式 non-login 方式进入bash 运行的；该文件包含专用于你的bash shell的bash信息,当登录时以及每次打开新的shell时,该文件被读取.（每个用户都有一个.bashrc文件，在用户目录下） /etc/bashrc对所有用户新打开的bash都生效，但~/.bashrc只对当前用户新打开的bash生效。



