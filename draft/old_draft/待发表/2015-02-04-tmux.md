---
layout: post
title: Maximum Awesome中的tmux配置。
category: linux
---

自定义tmux状态栏
http://stackoverflow.com/questions/9628435/tmux-status-bar-configuration

https://github.com/erikw/tmux-powerline

https://github.com/square/maximum-awesome
https://github.com/justaparth/maximum-awesome-linux

把以下脚本内容加入到~/.bashrc，即可每次登录进入到tmux

tmux_init()
{
    tmux new-session -s "kumu" -d -n "local"    # 开启一个会话
    tmux new-window -n "other"          # 开启一个窗口
    tmux split-window -h                # 开启一个竖屏
    tmux split-window -v "top"          # 开启一个横屏,并执行top命令
    tmux -2 attach-session -d           # tmux -2强制启用256color，连接已开启的tmux
}

# 判断是否已有开启的tmux会话，没有则开启
if which tmux 2>&1 >/dev/null; then
    test -z "$TMUX" && (tmux attach || tmux_init)
fi

我用的下面的方法。加到/etc/bash.bashrc
# If not running interactively, do not do anything
[[ $- != *i* ]] && return
[[ $TERM != screen* ]] && exec tmux

命名会话
tmux new -s session
tmux new -s session -d #在后台建立会话
tmux ls #列出会话
tmux attach -t session #进入某个会话

快速启动tmux
如果觉得每次都要打开tmux，然后在打开几个窗口和面板很麻烦，那么下面这个脚本你一定会 喜欢。参考这里
#!/bin/sh
#
# name     : tmuxen， tmux environment made easy
# author   : Xu Xiaodong xxdlhy@gmail.com
# license  : GPL
# created  : 2012 Jul 01
# modified : 2012 Jul 02
#

cmd=$(which tmux) # tmux path
session=codefun   # session name

if [ -z $cmd ]; then
  echo "You need to install tmux."
  exit 1
fi

$cmd has -t $session

if [ $? != 0 ]; then
  $cmd new -d -n vim -s $session "vim"
  $cmd splitw -v -p 20 -t $session "pry"
  $cmd neww -n mutt -t $session "mutt"
  $cmd neww -n irssi -t $session "irssi"
  $cmd neww -n cmus -t $session "cmus"
  $cmd neww -n zsh -t $session "zsh"
  $cmd splitw -h -p 50 -t $session "zsh"
  $cmd selectw -t $session:5
fi

$cmd att -t $session

exit 0


安装
sudo apt-get install tmux
安装完成后输入命令tmux即可打开软件，界面十分简单，类似一个下方带有状态栏的终端控制台； 不出意外，这时候你会跟我第一次一样，觉得tmux没什么牛逼的。
会话，窗口，面板
根据tmux的定义，在开启了tmux服务器后，会首先创建一个会话，而这个会话则会首先创建一个 窗口，其中仅包含一个面板；也就是说，这里看到的所谓终端控制台应该称作tmux的一个面板， 虽然其使用方法与终端控制台完全相同。
tmux使用C/S模型构建，主要包括以下单元模块：
server服务器。输入tmux命令时就开启了一个服务器。
session会话。一个服务器可以包含多个会话
window窗口。一个会话可以包含多个窗口。
pane面板。一个窗口可以包含多个面板。



当然，tmux的高级不止在于配置功能的强大，它还支持在命令行中对指定session进行设置。利用这个特性，便可以将繁琐的工作环境初始化用脚本完成了。比如我写了如下脚本对我的工作电脑进行初始化：

init_tmux.sh
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
#! /bin/bash
export AP_7x27_PROJECT="~/Developer/MSM7x27A-ICS-AP"
export MP_7x27_PROJECT="~/Developer/MSM7x27A-ICS-MP"

export AP_8x25_PROJECT="~/Developer/MSM8x25-ICS-AP"
export MP_8x25_PROJECT="~/Developer/MSM8x25-ICS-MP"

if [ -z "$TMUX" ]; then
    tmux has-session -t development7x27
    if [ $? != 0 ]; then
        # init 7x27 AP
        tmux new-session -s development7x27 -n AP_7x27 -d
        tmux send-keys -t development7x27 "cd $AP_7x27_PROJECT&&. ./build/envsetup.sh&&choosecombo 1 13 1" C-m
        tmux split-window -h -p 40 -t development7x27:1
        tmux send-keys -t development7x27 "cd $AP_7x27_PROJECT&&. ./build/envsetup.sh&&choosecombo 1 13 1" C-m
        tmux split-window -v -t development7x27:1.2
        tmux send-keys -t development7x27 "cd $AP_7x27_PROJECT&&. ./build/envsetup.sh&&choosecombo 1 13 1" C-m

        # init 7x27 MP
        tmux new-window -n MP_7x27 -t development7x27

        tmux send-keys -t development7x27:2 "cd $MP_7x27_PROJECT/modem_proc/build/ms" C-m
        tmux split-window -h -p 40 -t development7x27:2
        tmux send-keys -t development7x27:2 "cd $MP_7x27_PROJECT/modem_proc/build/ms" C-m
        tmux split-window -v -t development7x27:2.2
        tmux send-keys -t development7x27 "cd $MP_7x27_PROJECT/modem_proc/build/ms" C-m

        tmux select-window -t development7x27:1
        tmux select-pane -t development7x27:1 -L
    fi

        tmux send-keys -t development7x27:1.3 "export DISPLAY=$DISPLAY" C-m
        tmux send-keys -t development7x27:2.3 "export DISPLAY=$DISPLAY" C-m

    tmux has-session -t development8x25
    if [ $? != 0 ]; then
        # init 8x25 AP
        tmux new-session -s development8x25 -n AP_8x25 -d
        tmux send-keys -t development8x25 "cd $AP_8x25_PROJECT&&. ./build/envsetup.sh&&choosecombo 1 17 3" C-m
        tmux split-window -h -p 40 -t development8x25:1
        tmux send-keys -t development8x25 "cd $AP_8x25_PROJECT&&. ./build/envsetup.sh&&choosecombo 1 17 3" C-m
        tmux send-keys -t development8x25 'top' C-m
        tmux split-window -v -t development8x25:1.2
        tmux send-keys -t development8x25 "cd $AP_8x25_PROJECT&&. ./build/envsetup.sh&&choosecombo 1 17 3" C-m

        # init 8x25 MP
        tmux new-window -n MP_8x25 -t development8x25

        tmux send-keys -t development8x25:2 "cd $MP_8x25_PROJECT/modem_proc/build/ms" C-m
        tmux split-window -h -p 40 -t development8x25:2
        tmux send-keys -t development8x25:2 "cd $MP_8x25_PROJECT/modem_proc/build/ms" C-m
        tmux split-window -v -t development8x25:2.2
        tmux send-keys -t development8x25 "cd $MP_8x25_PROJECT/modem_proc/build/ms" C-m

        tmux select-window -t development8x25:1
        tmux select-pane -t development8x25:1 -L
    fi

        tmux send-keys -t development8x25:1.3 "export DISPLAY=$DISPLAY" C-m
        tmux send-keys -t development8x25:2.3 "export DISPLAY=$DISPLAY" C-m

    tmux attach -t development7x27
fi
脚本主体思想为每次运行时判断相应的tmux session是否存在，如果存在则设置Xwindow的变量后attach；如果不存在相应session，则新建相应session并初始化session中相应窗口和窗口分割，同时在每个窗口分割中运行每次都要运行的环境初始化命令。最后设置Xwindow环境变量后attach。我的脚本中分别初始化了高通7x27 AP和MP的编译环境以及8x25 AP和MP的编译环境。




开启批量执行

如果已经修改prefix键位Ctrl+a，则Ctrl+a[默认Ctrl+b]后输入:set synchronize-panes ，输入:set sync [TAB]键可自动补齐



取消批量执行模式重复之前操作即可


Control+b ! 关闭所有面板 
C-b x 关闭面板
C-b & 关闭窗口

C-b ? 显示快捷键帮助
C-b C-o 调换窗口位置，类似与vim 里的C-w
C-b 空格键 采用下一个内置布局
C-b ! 把当前窗口变为新窗口
C-b " 模向分隔窗口
C-b % 纵向分隔窗口
C-b q 显示分隔窗口的编号
C-b o 跳到下一个分隔窗口
C-b 上下键 上一个及下一个分隔窗口
C-b C-方向键 调整分隔窗口大小
C-b c 创建新窗口
C-b 0~9 选择几号窗口
C-b c 创建新窗口
C-b n 选择下一个窗口
C-b l 切换到最后使用的窗口
C-b p 选择前一个窗口
C-b w 以菜单方式显示及选择窗口
C-b t 显示时钟
C-b ; 切换到最后一个使用的面板
C-b x 关闭面板
C-b & 关闭窗口
C-b s 以菜单方式显示和选择会话
C-b d 退出tumx，并保存当前会话，这时，tmux仍在后台运行，可以通过tmux attach进入 到指定的会话